<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>מקצר כתובות URL</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        .input-container {
            margin: 20px 0;
        }
        input {
            padding: 10px;
            width: 300px;
            margin: 5px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
        .status {
            margin: 10px 0;
            font-size: 14px;
        }
        .loader {
            display: none;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 10px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #result {
            margin-top: 20px;
            padding: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <h1>מקצר כתובות URL</h1>
    
    <div class="input-container">
        <input type="url" id="longUrl" placeholder="הכנס כתובת URL" required>
    </div>
    
    <div class="input-container">
        <input type="text" id="customSlug" placeholder="בחר סיומת מותאמת אישית">
        <button onclick="checkSlug()">בדוק סיומת</button>
    </div>
    
    <div class="status" id="slugStatus"></div>
    <div class="loader" id="loader"></div>
    
    <button onclick="createShortUrl()" id="createButton" disabled>צור קישור</button>
    
    <div id="result">
        <p>הקישור המקוצר שלך:</p>
        <input type="text" id="shortUrl" readonly>
        <button onclick="copyToClipboard()">העתק קישור</button>
    </div>

    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        const SHEET_ID = '1wFv3BQhWQqDp2AjbGwI-p6ldO3okR8xJChf8MwGLfN4';
        const BASE_URL = 'https://yosefgli.github.io/url-shortener?';
        
        async function checkSlug() {
            const slug = document.getElementById('customSlug').value;
            if (!slug) {
                alert('נא להזין סיומת');
                return;
            }
            
            document.getElementById('loader').style.display = 'block';
            document.getElementById('slugStatus').textContent = 'בודק סיומת...';
            
            try {
                // Call Google Sheets API to check if slug exists
                const response = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SHEET_ID,
                    range: 'Sheet1!B:B'
                });
                
                const exists = response.result.values?.some(row => row[0] === slug);
                
                if (exists) {
                    document.getElementById('slugStatus').textContent = 'סיומת תפוסה';
                    document.getElementById('createButton').disabled = true;
                } else {
                    document.getElementById('slugStatus').textContent = 'סיומת תקינה';
                    document.getElementById('createButton').disabled = false;
                }
            } catch (error) {
                document.getElementById('slugStatus').textContent = 'שגיאה בבדיקת הסיומת';
                console.error('Error:', error);
            }
            
            document.getElementById('loader').style.display = 'none';
        }
        
        async function createShortUrl() {
            const longUrl = document.getElementById('longUrl').value;
            const slug = document.getElementById('customSlug').value;
            
            if (!longUrl || !slug) {
                alert('נא למלא את כל השדות');
                return;
            }
            
            try {
                // Add new row to Google Sheet
                await gapi.client.sheets.spreadsheets.values.append({
                    spreadsheetId: SHEET_ID,
                    range: 'Sheet1!A:B',
                    valueInputOption: 'RAW',
                    resource: {
                        values: [[longUrl, slug]]
                    }
                });
                
                const shortUrl = BASE_URL + slug;
                document.getElementById('shortUrl').value = shortUrl;
                document.getElementById('result').style.display = 'block';
            } catch (error) {
                alert('שגיאה ביצירת הקישור המקוצר');
                console.error('Error:', error);
            }
        }
        
        function copyToClipboard() {
            const shortUrl = document.getElementById('shortUrl');
            shortUrl.select();
            document.execCommand('copy');
            alert('הקישור הועתק ללוח');
        }
        
        // Initialize Google Sheets API
        gapi.load('client', async () => {
            await gapi.client.init({
                apiKey: 'AIzaSyC_UxO6u2GxTG7qILNhboLCC67bjVqWP2E',
                discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4']
            });
        });
    </script>
</body>
</html>
