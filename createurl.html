<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>בדיקת סיומת והכנסת נתונים</title>
</head>
<body>
    <h1>הכנסת קישור וסיומת</h1>

    <!-- ריבועים -->
    <div>
        <input type="text" id="linkInput" placeholder="הכנס קישור" style="width: 300px; height: 40px; margin: 10px;">
    </div>
    
    <div>
        <input type="text" id="suffixInput" placeholder="הכנס סיומת" style="width: 300px; height: 40px; margin: 10px;">
    </div>

    <button onclick="checkAndSubmit()">בדוק והכנס</button>

    <script>
        const spreadsheetId = '1wFv3BQhWQqDp2AjbGwI-p6ldO3okR8xJChf8MwGLfN4';
        const sheetName = 'גיליון1';

        // הפונקציה שתבצע את הבדיקה וההכנסה
        async function checkAndSubmit() {
            const link = document.getElementById('linkInput').value;
            const suffix = document.getElementById('suffixInput').value;
            
            if (!link || !suffix) {
                alert('נא למלא את כל השדות!');
                return;
            }

            // שלב 1: קבלת נתונים מהגוגל שיטס
            const isSuffixPresent = await checkSuffixInSheet(suffix);
            
            if (isSuffixPresent) {
                alert('הסיומת כבר קיימת בגוגל שיטס!');
                return;
            }

            // שלב 2: אישור והכנסת הנתונים
            const userConfirmed = confirm('הסיומת לא קיימת, האם להוסיף אותה לגוגל שיטס?');
            if (userConfirmed) {
                await addRowToSheet(link, suffix);
                alert('הנתונים הוזנו בהצלחה!');
            }
        }

        // פונקציה שבודקת אם הסיומת קיימת בעמודה B
        async function checkSuffixInSheet(suffix) {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${sheetName}!B:B?key=YOUR_API_KEY`;
            const response = await fetch(url);
            const data = await response.json();
            const values = data.values || [];

            for (let row of values) {
                if (row[0] && row[0].toLowerCase() === suffix.toLowerCase()) {
                    return true; // אם הסיומת כבר קיימת
                }
            }

            return false; // אם הסיומת לא קיימת
        }

        // פונקציה להוסיף שורה חדשה לגוגל שיטס
        async function addRowToSheet(link, suffix) {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${sheetName}!A1:B1:append?valueInputOption=RAW&key=YOUR_API_KEY`;
            const data = {
                values: [[link, suffix]]
            };

            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            });

            if (!response.ok) {
                alert('שגיאה בהכנסת הנתונים לגוגל שיטס.');
            }
        }
    </script>
</body>
</html>
